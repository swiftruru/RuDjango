{% extends 'blog/base.html' %}
{% load static %}

{% block title %}{{ action }} - RuDjango{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/articles/form.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="form-container">
        <div class="form-header">
            <h1>{{ action }}</h1>
        </div>

        <form method="post" novalidate>
            {% csrf_token %}

            <div class="form-group">
                <label for="id_title">{{ form.title.label }}</label>
                {{ form.title }}
                {% if form.title.help_text %}
                <span class="help-text">{{ form.title.help_text }}</span>
                {% endif %}
                {{ form.title.errors }}
            </div>

            <div class="form-group">
                <label for="id_content">{{ form.content.label }}</label>
                {{ form.content }}
                {% if form.content.help_text %}
                <span class="help-text">{{ form.content.help_text }}</span>
                {% endif %}
                {{ form.content.errors }}
            </div>

            <div class="form-group">
                <label for="id_tags-input">{{ form.tags_input.label }}</label>
                {{ form.tags_input }}
                {% if form.tags_input.help_text %}
                <span class="help-text">{{ form.tags_input.help_text }}</span>
                {% endif %}
                {{ form.tags_input.errors }}
            </div>

            <!-- ç™¼å¸ƒé¸é … -->
            <div class="form-group">
                <label for="id_status">ç™¼å¸ƒç‹€æ…‹</label>
                <select name="status" id="id_status" class="form-control">
                    <option value="published" {% if not article or article.status == 'published' %}selected{% endif %}>ç«‹å³ç™¼å¸ƒ</option>
                    <option value="draft" {% if article and article.status == 'draft' %}selected{% endif %}>å„²å­˜ç‚ºè‰ç¨¿</option>
                    <option value="scheduled" {% if article and article.status == 'scheduled' %}selected{% endif %}>æ’ç¨‹ç™¼å¸ƒ</option>
                </select>
            </div>

            <!-- æ’ç¨‹æ™‚é–“ (åƒ…åœ¨é¸æ“‡æ’ç¨‹ç™¼å¸ƒæ™‚é¡¯ç¤º) -->
            <div class="form-group" id="publish-at-group" style="display: none;">
                <label for="id_publish_at">æ’ç¨‹ç™¼å¸ƒæ™‚é–“</label>
                <input type="datetime-local" name="publish_at" id="id_publish_at" class="form-control"
                       value="{% if article and article.publish_at %}{{ article.publish_at|date:'Y-m-d\TH:i' }}{% endif %}">
                <span class="help-text">é¸æ“‡æ–‡ç« è‡ªå‹•ç™¼å¸ƒçš„æ™‚é–“</span>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if article %}âœï¸ æ›´æ–°æ–‡ç« {% else %}ğŸ“ å„²å­˜æ–‡ç« {% endif %}
                </button>
                <a href="{% if article %}{% url 'article_detail' article.id %}{% else %}{% url 'blog_home' %}{% endif %}"
                    class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
// æ§åˆ¶æ’ç¨‹æ™‚é–“æ¬„ä½çš„é¡¯ç¤º/éš±è—
document.addEventListener('DOMContentLoaded', function() {
    const statusSelect = document.getElementById('id_status');
    const publishAtGroup = document.getElementById('publish-at-group');
    const publishAtInput = document.getElementById('id_publish_at');

    function togglePublishAtField() {
        if (statusSelect.value === 'scheduled') {
            publishAtGroup.style.display = 'block';
            publishAtInput.required = true;
        } else {
            publishAtGroup.style.display = 'none';
            publishAtInput.required = false;
        }
    }

    // åˆå§‹åŒ–
    togglePublishAtField();

    // ç›£è½ç‹€æ…‹è®Šæ›´
    statusSelect.addEventListener('change', togglePublishAtField);
});
</script>
{% endblock %}
{% endblock %}