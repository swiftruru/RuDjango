{% extends 'blog/base.html' %}
{% load static %}
{% load blog_extras %}

{% block title %}é€²éšæœå°‹ - RuDjango{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/articles/list.css' %}">
<link rel="stylesheet" href="{% static 'blog/css/search-autocomplete.css' %}">
<style>
.advanced-search-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 3rem 0;
    color: white;
}

.search-filters {
    background: white;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
}

.filter-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #333;
}

.filter-input,
.filter-select {
    padding: 0.75rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.filter-input:focus,
.filter-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.tags-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.tag-checkbox {
    display: none;
}

.tag-label {
    padding: 0.5rem 1rem;
    background: #f0f0f0;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.tag-checkbox:checked + .tag-label {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.tag-label:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.search-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.btn-search,
.btn-reset {
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-search {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-search:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
}

.btn-reset {
    background: #f0f0f0;
    color: #666;
}

.btn-reset:hover {
    background: #e0e0e0;
}

.search-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.results-count {
    font-size: 1.1rem;
    color: #667eea;
    font-weight: 600;
}
</style>
{% endblock %}

{% block content %}
<section class="advanced-search-header">
    <div class="container">
        <h1>ğŸ” é€²éšæœå°‹</h1>
        <p>ä½¿ç”¨å¤šé‡æ¢ä»¶æ‰¾åˆ°æ‚¨éœ€è¦çš„æ–‡ç« </p>
    </div>
</section>

<section class="articles-section">
    <div class="container">
        <form method="get" action="{% url 'advanced_search' %}" class="search-filters">
            <!-- é—œéµå­—æœå°‹ -->
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">ğŸ” é—œéµå­—</label>
                    <input type="text" name="q" value="{{ search_query }}"
                           placeholder="æœå°‹æ¨™é¡Œæˆ–å…§å®¹..." class="filter-input">
                </div>

                <div class="filter-group">
                    <label class="filter-label">ğŸ‘¤ ä½œè€…</label>
                    <input type="text" name="author" value="{{ author_filter }}"
                           placeholder="ä½œè€…åç¨±..." class="filter-input">
                </div>

                <div class="filter-group">
                    <label class="filter-label">ğŸ“Š æ’åº</label>
                    <select name="sort" class="filter-select">
                        <option value="latest" {% if sort_by == 'latest' %}selected{% endif %}>æœ€æ–°ç™¼å¸ƒ</option>
                        <option value="oldest" {% if sort_by == 'oldest' %}selected{% endif %}>æœ€æ—©ç™¼å¸ƒ</option>
                        <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>æœ€å—æ­¡è¿</option>
                    </select>
                </div>
            </div>

            <!-- æ—¥æœŸç¯„åœ -->
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">ğŸ“… é–‹å§‹æ—¥æœŸ</label>
                    <input type="date" name="date_from" value="{{ date_from }}" class="filter-input">
                </div>

                <div class="filter-group">
                    <label class="filter-label">ğŸ“… çµæŸæ—¥æœŸ</label>
                    <input type="date" name="date_to" value="{{ date_to }}" class="filter-input">
                </div>
            </div>

            <!-- æ¨™ç±¤ç¯©é¸ -->
            <div class="filter-group">
                <label class="filter-label">ğŸ·ï¸ æ¨™ç±¤ï¼ˆå¯å¤šé¸ï¼‰</label>
                <div class="tags-grid">
                    {% for tag in all_tags %}
                    <input type="checkbox" name="tags" value="{{ tag.slug }}"
                           id="tag-{{ tag.slug }}" class="tag-checkbox"
                           {% if tag.slug in selected_tags %}checked{% endif %}>
                    <label for="tag-{{ tag.slug }}" class="tag-label">{{ tag.name }}</label>
                    {% endfor %}
                </div>
            </div>

            <div class="search-actions">
                <a href="{% url 'advanced_search' %}" class="btn-reset">æ¸…é™¤ç¯©é¸</a>
                <button type="submit" class="btn-search">ğŸ” æœå°‹</button>
            </div>
        </form>

        <!-- æœå°‹çµæœ -->
        {% if articles %}
        <div class="search-results-header">
            <div class="results-count">
                æ‰¾åˆ° {{ total_results }} ç¯‡æ–‡ç« 
            </div>
        </div>

        <div class="articles-grid">
            {% include 'blog/articles/_article_cards.html' %}
        </div>

        <!-- åˆ†é  -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page=1&q={{ search_query }}&author={{ author_filter }}&sort={{ sort_by }}&date_from={{ date_from }}&date_to={{ date_to }}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}"
               class="page-link">Â« é¦–é </a>
            <a href="?page={{ page_obj.previous_page_number }}&q={{ search_query }}&author={{ author_filter }}&sort={{ sort_by }}&date_from={{ date_from }}&date_to={{ date_to }}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}"
               class="page-link">â€¹ ä¸Šä¸€é </a>
            {% endif %}

            <span class="page-current">{{ page_obj.number }}</span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&q={{ search_query }}&author={{ author_filter }}&sort={{ sort_by }}&date_from={{ date_from }}&date_to={{ date_to }}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}"
               class="page-link">ä¸‹ä¸€é  â€º</a>
            <a href="?page={{ page_obj.paginator.num_pages }}&q={{ search_query }}&author={{ author_filter }}&sort={{ sort_by }}&date_from={{ date_from }}&date_to={{ date_to }}{% for tag in selected_tags %}&tags={{ tag }}{% endfor %}"
               class="page-link">æœ«é  Â»</a>
            {% endif %}
        </div>
        {% endif %}

        {% elif search_query or author_filter or selected_tags or date_from or date_to %}
        <div class="no-articles">
            <p>ğŸ˜” æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ–‡ç« </p>
            <a href="{% url 'advanced_search' %}" class="btn-back-to-articles">æ¸…é™¤ç¯©é¸</a>
        </div>
        {% else %}
        <div class="no-articles">
            <p>ğŸ’¡ è«‹ä½¿ç”¨ä¸Šæ–¹ç¯©é¸å™¨æœå°‹æ–‡ç« </p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
