{% extends 'blog/base.html' %}
{% load static %}
{% load blog_extras %}

{% block title %}
{% if list_type == 'followers' %}
è¿½è¹¤è€… - {{ member.first_name|default:member.username }}
{% else %}
è¿½è¹¤ä¸­ - {{ member.first_name|default:member.username }}
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/members/follow_list.css' %}">
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="header-content">
            <a href="{% url 'member_profile' username=member.username %}" class="back-link">
                <span class="back-icon">â†</span>
                è¿”å›å€‹äººé é¢
            </a>
            <h1 class="page-title">
                {% if list_type == 'followers' %}
                ğŸ‘¥ è¿½è¹¤è€…
                {% else %}
                ğŸŒŸ è¿½è¹¤ä¸­
                {% endif %}
            </h1>
            <p class="page-subtitle">
                {{ member.first_name|default:member.username }} çš„{% if list_type == 'followers' %}è¿½è¹¤è€…{% else %}è¿½è¹¤ä¸­{% endif %}
                <span class="count-badge">{{ total_count }}</span>
            </p>
        </div>
    </div>
</section>

<!-- Follow List Content -->
<section class="follow-list-content">
    <div class="container">
        <div class="follow-list-wrapper">
            {% if page_obj %}
            <div class="users-grid">
                {% for follow in page_obj %}
                <div class="user-card">
                    <div class="user-avatar">
                        {% if list_type == 'followers' %}
                        {% if follow.follower.profile.avatar %}
                        <img src="{{ follow.follower.profile|avatar_url }}" alt="{{ follow.follower.username }}">
                        {% else %}
                        <div class="avatar-placeholder">
                            {{ follow.follower.username|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        {% else %}
                        {% if follow.following.profile.avatar %}
                        <img src="{{ follow.following.profile|avatar_url }}" alt="{{ follow.following.username }}">
                        {% else %}
                        <div class="avatar-placeholder">
                            {{ follow.following.username|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        {% endif %}
                    </div>
                    <div class="user-info">
                        <h3 class="user-name">
                            {% if list_type == 'followers' %}
                            <a href="{% url 'member_profile' username=follow.follower.username %}">
                                {{ follow.follower.first_name|default:follow.follower.username }}
                            </a>
                            {% else %}
                            <a href="{% url 'member_profile' username=follow.following.username %}">
                                {{ follow.following.first_name|default:follow.following.username }}
                            </a>
                            {% endif %}
                        </h3>
                        <p class="user-username">
                            {% if list_type == 'followers' %}
                            @{{ follow.follower.username }}
                            {% else %}
                            @{{ follow.following.username }}
                            {% endif %}
                        </p>
                        {% if list_type == 'followers' %}
                        {% if follow.follower.profile.bio %}
                        <p class="user-bio">{{ follow.follower.profile.bio|truncatewords:15 }}</p>
                        {% endif %}
                        {% else %}
                        {% if follow.following.profile.bio %}
                        <p class="user-bio">{{ follow.following.profile.bio|truncatewords:15 }}</p>
                        {% endif %}
                        {% endif %}
                        <div class="user-stats">
                            <span class="stat-item">
                                <span class="stat-icon">ğŸ“</span>
                                {% if list_type == 'followers' %}
                                {{ follow.follower.articles.count }} æ–‡ç« 
                                {% else %}
                                {{ follow.following.articles.count }} æ–‡ç« 
                                {% endif %}
                            </span>
                            <span class="stat-item">
                                <span class="stat-icon">ğŸ‘¥</span>
                                {% if list_type == 'followers' %}
                                {{ follow.follower.followers.count }} è¿½è¹¤è€…
                                {% else %}
                                {{ follow.following.followers.count }} è¿½è¹¤è€…
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    <div class="user-actions">
                        {% if request.user.is_authenticated %}
                        {% if list_type == 'followers' %}
                        {% if follow.follower == request.user %}
                        <span class="self-badge">é€™æ˜¯ä½ </span>
                        {% else %}
                        <button
                            class="btn-follow {% if following_status|get_item:follow.follower.id %}following{% endif %}"
                            data-username="{{ follow.follower.username }}"
                            data-following="{% if following_status|get_item:follow.follower.id %}true{% else %}false{% endif %}">
                            <span class="follow-icon">{% if following_status|get_item:follow.follower.id %}âœ“{% else %}+{% endif %}</span>
                            <span class="follow-text">{% if following_status|get_item:follow.follower.id %}å·²è¿½è¹¤{% else %}è¿½è¹¤{% endif %}</span>
                        </button>
                        {% endif %}
                        {% else %}
                        {% if follow.following == request.user %}
                        <span class="self-badge">é€™æ˜¯ä½ </span>
                        {% else %}
                        <button
                            class="btn-follow {% if following_status|get_item:follow.following.id %}following{% endif %}"
                            data-username="{{ follow.following.username }}"
                            data-following="{% if following_status|get_item:follow.following.id %}true{% else %}false{% endif %}">
                            <span class="follow-icon">{% if following_status|get_item:follow.following.id %}âœ“{% else %}+{% endif %}</span>
                            <span class="follow-text">{% if following_status|get_item:follow.following.id %}å·²è¿½è¹¤{% else %}è¿½è¹¤{% endif %}</span>
                        </button>
                        {% endif %}
                        {% endif %}
                        {% else %}
                        <a href="{% url 'user_login' %}?next={{ request.path }}" class="btn-follow">
                            <span class="follow-icon">+</span>
                            <span class="follow-text">è¿½è¹¤</span>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if page_obj.paginator.num_pages > 1 %}
            <div class="pagination">
                {% if page_obj.has_previous %}
                <a href="?page=1" class="page-link">Â« é¦–é </a>
                <a href="?page={{ page_obj.previous_page_number }}" class="page-link">â€¹ ä¸Šä¸€é </a>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <span class="page-current">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a href="?page={{ num }}"
                    class="page-link">{{ num }}</a>
                    {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="page-link">ä¸‹ä¸€é  â€º</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}" class="page-link">æœ«é  Â»</a>
                    {% endif %}
            </div>
            {% endif %}

            {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    {% if list_type == 'followers' %}
                    ğŸ‘¥
                    {% else %}
                    ğŸŒŸ
                    {% endif %}
                </div>
                <h3 class="empty-title">
                    {% if list_type == 'followers' %}
                    é‚„æ²’æœ‰è¿½è¹¤è€…
                    {% else %}
                    é‚„æ²’æœ‰è¿½è¹¤ä»»ä½•äºº
                    {% endif %}
                </h3>
                <p class="empty-text">
                    {% if is_own_profile %}
                    {% if list_type == 'followers' %}
                    æŒçºŒç™¼è¡¨å„ªè³ªå…§å®¹ï¼Œæœƒæœ‰æ›´å¤šäººè¿½è¹¤ä½ ï¼
                    {% else %}
                    é–‹å§‹è¿½è¹¤å…¶ä»–æœƒå“¡ï¼Œæ¢ç´¢æ›´å¤šç²¾å½©å…§å®¹å§ï¼
                    {% endif %}
                    {% else %}
                    {{ member.first_name|default:member.username }} {% if list_type == 'followers' %}é‚„æ²’æœ‰è¿½è¹¤è€…{% else %}é‚„æ²’æœ‰è¿½è¹¤ä»»ä½•äºº{% endif %}
                    {% endif %}
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'blog/js/members/follow_list.js' %}"></script>
{% endblock %}