{% extends 'blog/base.html' %}
{% load static %}

{% block title %}æ’°å¯«è¨Šæ¯ - RuDjango{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/messages.css' %}">
<link rel="stylesheet" href="{% static 'blog/css/user-autocomplete.css' %}">
{% endblock %}

{% block content %}
<div class="messages-container">
    <h1 class="messages-title">âœï¸ æ’°å¯«è¨Šæ¯</h1>

    <!-- è¨Šæ¯å°èˆª -->
    <div class="messages-nav">
        <a href="{% url 'inbox' %}" class="nav-tab">ğŸ“¥ æ”¶ä»¶åŒ£</a>
        <a href="{% url 'outbox' %}" class="nav-tab">ğŸ“¤ å¯„ä»¶åŒ£</a>
        <a href="{% url 'message_compose' %}" class="nav-tab active compose-btn">âœï¸ æ’°å¯«è¨Šæ¯</a>
    </div>

    <!-- è¨Šæ¯è¡¨å–® -->
    <div class="message-form-container">
        <form method="post" class="message-form">
            {% csrf_token %}

            <div class="form-group">
                <label for="{{ form.recipient_username.id_for_label }}">
                    {{ form.recipient_username.label }}
                    <span class="required">*</span>
                </label>
                {{ form.recipient_username }}
                {% if form.recipient_username.errors %}
                    <div class="error-message">
                        {{ form.recipient_username.errors }}
                    </div>
                {% endif %}
                {% if recipient %}
                    <div class="hint-message">
                        æ­£åœ¨ç™¼é€è¨Šæ¯çµ¦ <strong>{{ recipient.first_name|default:recipient.username }}</strong>
                    </div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="{{ form.subject.id_for_label }}">
                    {{ form.subject.label }}
                    <span class="required">*</span>
                </label>
                {{ form.subject }}
                {% if form.subject.errors %}
                    <div class="error-message">
                        {{ form.subject.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="{{ form.content.id_for_label }}">
                    {{ form.content.label }}
                    <span class="required">*</span>
                </label>
                {{ form.content }}
                {% if form.content.errors %}
                    <div class="error-message">
                        {{ form.content.errors }}
                    </div>
                {% endif %}
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit">ğŸ“¤ ç™¼é€è¨Šæ¯</button>
                <a href="{% url 'inbox' %}" class="btn-cancel">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'blog/js/user-autocomplete.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ç‚ºæ”¶ä»¶è€…è¼¸å…¥æ¡†æ·»åŠ è‡ªå‹•å®ŒæˆåŠŸèƒ½
    const recipientInput = document.getElementById('{{ form.recipient_username.id_for_label }}');
    if (recipientInput && !recipientInput.hasAttribute('readonly')) {
        recipientInput.setAttribute('data-user-autocomplete', '');
        new UserAutocomplete(recipientInput);
    }
});
</script>
{% endblock %}
