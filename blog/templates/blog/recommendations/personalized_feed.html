{% extends 'blog/base.html' %}
{% load static %}
{% load blog_extras %}

{% block title %}å€‹äººåŒ–æ¨è–¦ - RuDjango{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/articles/list.css' %}">
<link rel="stylesheet" href="{% static 'blog/css/tags.css' %}">
<style>
.recommendation-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 2rem 0;
    margin-bottom: 2rem;
    color: white;
    border-radius: 12px;
}

.recommendation-header h1 {
    margin: 0 0 0.5rem 0;
    font-size: 2rem;
}

.recommendation-header p {
    margin: 0;
    opacity: 0.9;
}

.recommendation-stats {
    display: flex;
    gap: 2rem;
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.stat-item {
    flex: 1;
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #667eea;
    display: block;
}

.stat-label {
    font-size: 0.9rem;
    color: #666;
    margin-top: 0.5rem;
}

.recent-reads {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.recent-reads h3 {
    margin: 0 0 1rem 0;
    font-size: 1.2rem;
}

.recent-reads-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.recent-read-item {
    background: white;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    border-left: 3px solid #667eea;
    transition: all 0.2s;
}

.recent-read-item:hover {
    transform: translateX(5px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.recent-read-item a {
    color: #333;
    text-decoration: none;
    font-weight: 500;
}

.recent-read-time {
    font-size: 0.85rem;
    color: #999;
    margin-left: 0.5rem;
}

.recommendation-badge {
    display: inline-block;
    background: #667eea;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
}

@media (max-width: 768px) {
    .recommendation-stats {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<section class="hero">
    <div class="container">
        <div class="recommendation-header">
            <h1>âœ¨ ç‚ºä½ æ¨è–¦</h1>
            <p>åŸºæ–¼ä½ çš„é–±è®€ç¿’æ…£ï¼Œæˆ‘å€‘ç‚ºä½ ç²¾é¸äº†é€™äº›æ–‡ç« </p>
        </div>
    </div>
</section>

<section class="articles-section">
    <div class="container">
        <!-- æ¨è–¦çµ±è¨ˆ -->
        <div class="recommendation-stats">
            <div class="stat-item">
                <span class="stat-number">{{ total_recommendations }}</span>
                <span class="stat-label">æ¨è–¦æ–‡ç« </span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ recent_reads|length }}</span>
                <span class="stat-label">æœ€è¿‘é–±è®€</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ page_obj.paginator.count }}</span>
                <span class="stat-label">æœ¬é é¡¯ç¤º</span>
            </div>
        </div>

        <!-- æœ€è¿‘é–±è®€çš„æ–‡ç«  -->
        {% if recent_reads %}
        <div class="recent-reads">
            <h3>ğŸ“š ä½ æœ€è¿‘é–±è®€çš„æ–‡ç« </h3>
            <div class="recent-reads-list">
                {% for read in recent_reads %}
                <div class="recent-read-item">
                    <a href="{% url 'article_detail' read.article.id %}">
                        {{ read.article.title }}
                    </a>
                    <span class="recent-read-time">{{ read.last_read_at|timesince }}å‰</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- æ¨è–¦æ–‡ç« åˆ—è¡¨ -->
        <div class="article-actions-bar">
            <div class="article-actions-left">
                <h2 class="section-title">å€‹äººåŒ–æ¨è–¦æ–‡ç« </h2>
            </div>
        </div>

        {% if articles %}
        <!-- åˆ†é å°èˆªï¼ˆé ‚éƒ¨ï¼‰ -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page=1" class="page-link">Â« é¦–é </a>
            <a href="?page={{ page_obj.previous_page_number }}" class="page-link">â€¹ ä¸Šä¸€é </a>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="page-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}" class="page-link">{{ num }}</a>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="page-link">ä¸‹ä¸€é  â€º</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="page-link">æœ«é  Â»</a>
            {% endif %}
        </div>
        {% endif %}

        <div class="articles-grid">
            {% for article in articles %}
            <article class="article-card">
                <span class="recommendation-badge">ç‚ºä½ æ¨è–¦</span>
                <div class="article-header">
                    <div class="article-title-wrapper">
                        <h3 class="article-title">
                            <a href="{% url 'article_detail' article.id %}" title="{{ article.title }}">
                                {{ article.title }}
                            </a>
                        </h3>
                    </div>
                    <time class="article-date">{{ article.created_at|date:"Yå¹´mæœˆdæ—¥" }}</time>
                </div>
                <div class="article-content">
                    <p>{{ article.content|striptags|truncatewords:30 }}</p>
                </div>
                <div class="article-footer">
                    <div class="article-footer-info">
                        <span class="article-time">ğŸ“… {{ article.created_at|date:"Y-m-d H:i" }}</span>
                        <span class="author-name">âœï¸ <a href="{% url 'member_profile' article.author.username %}" class="author-link">{{ article.author.first_name|default:article.author.username }}</a></span>
                    </div>
                    <div class="article-stats">
                        <span class="stat-item">â¤ï¸ {{ article.likes.count }}</span>
                        <span class="stat-item">ğŸ’¬ {{ article.comments.count }}</span>
                    </div>
                </div>
                {% if article.tags.all %}
                <div class="article-tags">
                    {% for tag in article.tags.all %}
                    <a href="{% url 'tag_articles' tag.slug %}" class="tag">ğŸ·ï¸ {{ tag.name }}</a>
                    {% endfor %}
                </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>

        <!-- åˆ†é å°èˆªï¼ˆåº•éƒ¨ï¼‰ -->
        {% if page_obj.has_other_pages %}
        <div class="pagination bottom">
            {% if page_obj.has_previous %}
            <a href="?page=1" class="page-link">Â« é¦–é </a>
            <a href="?page={{ page_obj.previous_page_number }}" class="page-link">â€¹ ä¸Šä¸€é </a>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="page-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}" class="page-link">{{ num }}</a>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="page-link">ä¸‹ä¸€é  â€º</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="page-link">æœ«é  Â»</a>
            {% endif %}
        </div>
        {% endif %}
        {% else %}
        <div class="no-articles">
            <p>ğŸ˜” ç›®å‰æ²’æœ‰æ¨è–¦æ–‡ç« </p>
            <p>å¤šé–±è®€ä¸€äº›æ–‡ç« ï¼Œæˆ‘å€‘å°±èƒ½ç‚ºä½ æä¾›æ›´ç²¾æº–çš„æ¨è–¦ï¼</p>
            <a href="{% url 'blog_home' %}" class="btn-back-to-articles">ç€è¦½æ‰€æœ‰æ–‡ç« </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
